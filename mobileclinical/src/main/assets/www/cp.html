<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,height=device-height,user-scalable=no" />
    <title>临床路径</title>
    <link rel="Stylesheet" href="content/site.css" />
    <style type="text/css">
        .nav-left { width: 17.5%; height: 100%; float: left; background-color: #EEEEEE; text-align: center; padding-right: 20px; padding-bottom: 5.5em;}
        .nav-menu { height: 5.5em; line-height: 5.5em; }
        .nav-menu .right { height: 100%; width: 10px; position: relative; top: -5.5em; left: 100%; margin-left: -10px; }
        .nav-menu .inner { height: 100%; overflow:hidden;white-space:nowrap;text-overflow:ellipsis; margin-right: 8px; -webkit-box-shadow: 0 10px 15px #D6DEE6; -moz-box-shadow: 0 10px 15px #D6DEE6; box-shadow: 0 10px 15px #D6DEE6;  font-size: 1.5em; }
        .menu-done .inner { FILTER: progid:DXImageTransform.Microsoft.Gradient(gradientType=0,startColorStr=#C6C5C5,endColorStr=#959595); /*IE 6 7 8*/ background: -ms-linear-gradient(top, #C6C5C5, #959595); /* IE 10 */ background: -moz-linear-gradient(top,#C6C5C5,#959595); /*火狐*/ background: -webkit-gradient(linear, 0% 0%, 0% 100%,from(#C6C5C5), to(#959595)); /*谷歌*/ background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#C6C5C5), to(#959595)); /* Safari 4-5, Chrome 1-9*/ background: -webkit-linear-gradient(top, #C6C5C5, #959595); /*Safari5.1 Chrome 10+*/ background: -o-linear-gradient(top, #C6C5C5, #959595); /*Opera 11.10+*/color: #FFFFFF; }
        .menu-plan .inner { FILTER: progid:DXImageTransform.Microsoft.Gradient(gradientType=0,startColorStr=#F9FCFB,endColorStr=#E6E6E7); /*IE 6 7 8*/ background: -ms-linear-gradient(top, #F9FCFB, #E6E6E7); /* IE 10 */ background: -moz-linear-gradient(top,#F9FCFB,#E6E6E7); /*火狐*/ background: -webkit-gradient(linear, 0% 0%, 0% 100%,from(#F9FCFB), to(#E6E6E7)); /*谷歌*/ background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#F9FCFB), to(#E6E6E7)); /* Safari 4-5, Chrome 1-9*/ background: -webkit-linear-gradient(top, #F9FCFB, #E6E6E7); /*Safari5.1 Chrome 10+*/ background: -o-linear-gradient(top, #F9FCFB, #E6E6E7); /*Opera 11.10+*/color: #555555; }
        .menu-active .right { background: url('content/images/scheduler-arrow.png') no-repeat center; }
        .menu-active .inner { FILTER: progid:DXImageTransform.Microsoft.Gradient(gradientType=0,startColorStr=#005aff,endColorStr=#0037C2); /*IE 6 7 8*/ background: -ms-linear-gradient(top, #005aff, #0037C2); /* IE 10 */ background: -moz-linear-gradient(top,#005aff,#0037C2); /*火狐*/ background: -webkit-gradient(linear, 0% 0%, 0% 100%,from(#005aff), to(#0037C2)); /*谷歌*/ background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#005aff), to(#0037C2)); /* Safari 4-5, Chrome 1-9*/ background: -webkit-linear-gradient(top, #005aff, #0037C2); /*Safari5.1 Chrome 10+*/ background: -o-linear-gradient(top, #005aff, #0037C2); /*Opera 11.10+*/ border: none;color: #FFFFFF; }
        .content { width: 82.5%; height: 100%; float: right; background-color: #FFFFFF; }
        .tpl-row { display: none !important; }
        .data-row { color: #525252; }
        .order-list-head { width: 100%; color: #8A8A8A; font-size: 1.625em; position: relative; top: -100%; table-layout: fixed; }
        .h_c1 { vertical-align: middle; text-align: left; height: 3.3846em; border-bottom: 1px #DFDFDF solid; border-right: 1px #DFDFDF solid; padding-left: 15px; }
        .h_c2 { vertical-align: middle; text-align: right; border-bottom: 1px #DFDFDF solid; }
        .h_c3 { vertical-align: middle; text-align: left; border-bottom: 1px #DFDFDF solid; border-right: 1px #DFDFDF solid; }
        .h_c4 { vertical-align: middle; text-align: center; border-bottom: 1px #DFDFDF solid; border-right: 1px #DFDFDF solid; }
        .h_c5 { vertical-align: middle; text-align: center; border-bottom: 1px #DFDFDF solid; border-right: 1px #DFDFDF solid; }
        .h_c6 { vertical-align: middle; text-align: center; border-bottom: 1px #DFDFDF solid; }
        .data-container { height: 100%; padding-top: 5.5em; width: 100%; }
        .data-container .data-viewport { overflow-y: auto; height: 100%; width: 100%; }
        #order-list-body { width: 100%; font-size: 1.5em; table-layout: fixed; }
        .b_c1 { vertical-align: middle; text-align: left; border-bottom: 1px #DFDFDF solid; border-right: 1px #DFDFDF solid; padding-left: 15px; }
        .b_c2 { height: 3.65em; vertical-align: middle; text-align: right; border-bottom: 1px #DFDFDF solid; }
        .b_c3 { vertical-align: middle; text-align: left; border-bottom: 1px #DFDFDF solid; border-right: 1px #FFFFFF solid; }
        .b_c4 { vertical-align: middle; text-align: center; border-bottom: 1px #DFDFDF solid; border-right: 1px #FFFFFF solid; }
        .b_c5 { vertical-align: middle; text-align: center; border-bottom: 1px #DFDFDF solid; border-right: 1px #FFFFFF solid; }
        .b_c6 { vertical-align: middle; text-align: left; border-bottom: 1px #DFDFDF solid; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .zxsj { color: #8A8A8A; font-size: 80%; }
    </style>
</head>
<body>
    <div class="clinical-viewport">
        <div class="nav-left">
            <div style="height: 100%; background-color: #FFFFFF;overflow-y:auto;">
                <div id="menu-container" class="data-source-binding" data-source="{binding Schedulers}" data-formater="formaterScheduler">
                    <div class="tpl-row nav-menu {$menucls}" onclick="menuClick(this);" id="r_{$rid}">
                        <div class="inner">{$rcms}</div>
                        <div class="right"></div>
                    </div>
                </div>
            </div>
            <div style="height:5.5em;display: table; _position: relative; overflow: hidden;width:100%;background-color:#D6D6D6;">
                <div style="vertical-align: middle; display: table-cell; _position: absolute; _top: 50%;width:100%;">
                    <div style="_position: relative; _top: -50%;width:100%;">
                        <div style="font-size:1.2em;color:#656565;text-align:center;width:100%;">当前临床路径</div>
                        <div style="font-size:1.3em;color:#0063D1;text-align:center;width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" id="nameholder"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="content">
            <div class="data-container">
                <div class="data-viewport">
                    <table id="order-list-body" class="data-source-binding" data-source="{binding Orders}" data-formater="formaterOrder" border="0" cellpadding="0" cellspacing="0" data-default-rows="7">
                        <colgroup>
                            <col style="width: 15%" />
                            <col style="width: 4%" />
                            <col style="width: 41%" />
                            <col style="width: 8%" />
                            <col style="width: 8%" />
                            <col style="width: 24%" />
                        </colgroup>
                        <tr class="tpl-row">
                            <td class="b_c1">{$znmd}</td>
                            <td class="b_c2">{$czwz}</td>
                            <td class="b_c3">{$jhnr}</td>
                            <td class="b_c4">{$xz}</td>
                            <td class="b_c5">{$yzzt}</td>
                            <td class="b_c6">{$byyy}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <table class="order-list-head" border="0" cellpadding="0" cellspacing="0">
                <colgroup>
                    <col style="width: 15%" />
                    <col style="width: 4%" />
                    <col style="width: 41%" />
                    <col style="width: 8%" />
                    <col style="width: 8%" />
                    <col style="width: 24%" />
                </colgroup>
                <thead>
                    <tr>
                        <td class="h_c1">治疗目的</td>
                        <td class="h_c2">&nbsp;</td>
                        <td class="h_c3">计划内容</td>
                        <td class="h_c4">性质</td>
                        <td class="h_c5">状态</td>
                        <td class="h_c6">变异原因</td>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <script src="scripts/jquery-1.11.3.min.js" type="text/javascript"></script>
    <!--<script src="content/demo/demo.js"></script>-->
    <script src="scripts/common.js" type="text/javascript"></script>
    <script type="text/javascript">
        var menuContainer = document.getElementById("menu-container");
        function menuClick(it) {
            var mactived = menuContainer["active-menu"];
            if (it == mactived) return;
            if (mactived) $(mactived).removeClass("menu-active");
            $(it).addClass("menu-active");
            menuContainer["active-menu"] = it;
            loadRcmx(it.id.substr(2));
        }
    </script>
    <script type="text/javascript">
        var $Path = {};
        var allOrders = [];
        var Orders = [];
        var Schedulers = [];
        var CurrentScheduler = { idx: -1, rec: null };

        var formaterScheduler = {
            menucls: function (rec, idx) {
                var arr = [];
                if (idx < CurrentScheduler.idx) arr.push("menu-done");
                else arr.push("menu-plan");
                if (rec == CurrentScheduler.rec) arr.push("menu-active");
                return arr.join(" ");
            },
            rcms: function (rec, idx) {
                if (CurrentScheduler.idx == idx) return "→&nbsp;" + $.trim(rec.rcms);
                return rec.rcms;
            }
        };

        var formaterOrder = {

            jhnr: function (rec) {
                var text = "";
                if (rec.idm > 0) text = String.format("{0}&nbsp;/&nbsp;{1}{2}&nbsp;/&nbsp;{3}&nbsp;/&nbsp;{4}", rec.ypmc, rec.ypjl, rec.jldw, rec.yfmc, rec.pcmc);
                else text = rec.ypmc;
                if (rec.yzzt > 0) text += ("<BR/><span class=\"zxsj\">" + (rec.ksrq && Date.fromRq16(rec["ksrq"]).format("yyyy.MM.dd HH:mm").substr(2) || "") + "</span>");
                return text;
            },
            xz: function (rec) {
                if (rec.xz == 0) return "可选";
                if (rec.xz == 1) return "必选";
                return "新增";
            },
            czwz: function (rec) {
                if (rec.czwz == 1) return "┏";
                if (rec.czwz == 3) return "┗";
                if (rec.czwz == 2) return "┃";
                return "";
            },
            yzzt: function (rec) {
                if (rec.yzzt < 0 && rec.xz == 1) return "<img src=\"content/images/zxzt1-0.png\"/>";
                else if (rec.xz == 1) return "<img src=\"content/images/zxzt1-1.png\"/>";
                else if (rec.xz == 0 && rec.yzzt < 0) return "<img src=\"content/images/zxzt0-0.png\"/>";
                else if (rec.xz == 0) return "<img src=\"content/images/zxzt0-1.png\"/>";
                else return "";
            }
        }

        function loadRcmx(rid) {
            this.Orders = getSchedulerOrders(rid);
            bindingData("order-list-body");
            resetLayout();
        }
        function loadData(syxh,yexh) {
            var patient = $App.getData("CURRENT_PATIENT");
            if (syxh > 0 && (!patient || patient.syxh != syxh)) patient = $decode($App.setData("CURRENT_PATIENT", $App.findData("patient", "info", String.format("{\"syxh\":{0},\"yexh\":{1}}", syxh, yexh)).json));
            var data = $App.findData("clinicalpath", "cp-lcinfo", String.format("{\"syxh\":{0},\"yexh\":{1}}", patient.syxh, patient.yexh));
            this.$Path = $decode(data.json);
            this.$Path._mjson = data.json;
            allOrders = $App.findData("clinicalpath", "cp-lcjhzxinfo", String.format("{\"syxh\":{0},\"yexh\":{1}}", patient.syxh, patient.yexh));
            this.Schedulers = this.$Path.ljlcjh;
            if (this.$Path.dqlc) {
                for (var i = 0; i < this.Schedulers.length; i++) {
                    var s = this.Schedulers[i];
                    if (s.rid != this.$Path.dqlc.rid) continue;
                    this.CurrentScheduler = { idx: i, rec: s };
                    break;
                }
            }
            $("#nameholder").text($.trim(this.$Path.ljmc) || "");
            bindingData("menu-container");

            if (this.CurrentScheduler.idx > -1) {
                var m = document.getElementById("r_" + this.CurrentScheduler.rec.rid);
                menuClick(m);
                $(document.getElementById("menu-container").parentElement).scrollTop($(m).offset().top + $(m).height());
            }
        }
        function getSchedulerOrders(rid) {
            for (var i = 0; i < allOrders.length; i++) {
                var rec = allOrders[i];
                var data = (rec.json && $decode(rec.json)) || rec;
                data._mjson = data._mjson || rec.json;
                allOrders[i] = data;
                if (data.rid == rid) return data.Lcjhzxmx;
            }
            return [];
        }
        function resetLayout() {
            var tab = document.getElementById("order-list-body");
            var rowCount = tab.children[1].children.length;
            for (var i = 1; i < rowCount; i++) {
                var row = tab.children[1].children[i];
                var cell = row.children[0];
                var zlmd = $.trim($(cell).text());
                if (!zlmd) continue;
                if (i == rowCount - 1) break;
                var rowspan = 1;
                var j = i + 1;
                var cells = [];
                for (; j < rowCount; j++) {
                    var nextRow = tab.children[1].children[j];
                    var nextCell = nextRow.children[0];
                    var nextZlmd = $.trim($(nextCell).text());
                    if (zlmd != nextZlmd) break;
                    rowspan++;
                    cells.push(nextCell);
                }

                if (rowspan > 1) {
                    cell.rowSpan = rowspan;
                    i = j - 1;
                    $(cells).remove();
                }
            }
        }
        //$(document).ready(function () { setTimeout(loadData, 1) });
    </script>
</body>
</html>
